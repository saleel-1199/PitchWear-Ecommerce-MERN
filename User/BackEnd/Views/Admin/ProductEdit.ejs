<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title || "Edit Product" %></title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .image-slot {
  border: 2px dashed #d1d5db;
  border-radius: 14px;
  aspect-ratio: 1 / 1;
  cursor: pointer;
  display: block;
  background: #fafafa;
  position: relative;
  overflow: hidden;
}

    .image-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  display: block;
}
    .placeholder {
      color: #6b7280;
      text-align: center;
      font-size: 14px;
    }
    .plus {
      font-size: 34px;
    }
  </style> 
  
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css"
/>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"
  defer
></script>

<script>
  let files = [null, null, null];

  function selectImage(e, index) {
    const file = e.target.files[0];
    if (!file) return;

    const modal = document.createElement("div");
    modal.className = "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
    modal.innerHTML = `
      <div class="bg-white p-6 rounded-xl w-[600px]">
        <img id="cropImg" class="max-h-[350px] mx-auto"/>
        <div class="flex justify-end gap-3 mt-4">
          <button id="cancel">Cancel</button>
          <button id="done" class="bg-green-600 text-white px-4 py-2 rounded">Done</button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);

    const img = modal.querySelector("#cropImg");
    img.src = URL.createObjectURL(file);

    let cropper;
    img.onload = () => {
      cropper = new Cropper(img, { aspectRatio: 1 });
    };

    modal.querySelector("#cancel").onclick = () => {
      cropper.destroy();
      modal.remove();
    };

    modal.querySelector("#done").onclick = () => {
      cropper.getCroppedCanvas({ width: 900, height: 900 }).toBlob(blob => {
        const newFile = new File([blob], `image-${Date.now()}.jpg`, {
          type: "image/jpeg"
        });

        files[index] = newFile;

        // Update preview
        document.querySelectorAll(".image-slot img")[index].src =
          URL.createObjectURL(newFile);

        // Sync hidden input
        const dt = new DataTransfer();
        files.forEach(f => f && dt.items.add(f));
        document.getElementById("finalImages").files = dt.files;

        cropper.destroy();
        modal.remove();
      });
    };
  }
</script>


</head>

<body class="bg-[#f8f8f4] text-gray-800">

<header class="bg-[#eff2c8] px-10 py-5 flex justify-between items-center">
  <div class="flex gap-8 items-center">
    <h1 class="font-bold text-lg">Pitchwear</h1>
    <p class="text-sm font-semibold">Admin Dashboard</p>
  </div>
</header>

<main class="flex px-10 py-10 gap-10">

<aside class="w-64">
  <nav class="space-y-2 text-sm">
    <a href="/admin/dashboard" class="block px-4 py-2 rounded-lg hover:bg-white">üè† Dashboard</a>
    <a href="/admin/products" class="block px-4 py-2 rounded-lg bg-white font-medium">üëï Product Management</a>
    <a href="/admin/logout" class="block px-4 py-2 rounded-lg text-red-600 mt-6">‚õî Logout</a>
  </nav>
</aside>

<section class="flex-1">

  <nav class="mb-6 text-sm" aria-label="Breadcrumb">
  <ol class="flex items-center space-x-2 text-gray-500">

    <li>
      <a href="/admin/dashboard"
         class="hover:text-gray-700 font-medium">
        Dashboard
      </a>
    </li>

    <li>/</li>

    <li>
      <a href="/admin/products"
         class="hover:text-gray-700 font-medium">
        Products
      </a>
    </li>

    <li>/</li>

    <li class="text-gray-700 font-semibold">
      Edit Product
    </li>

  </ol>
</nav>


  <h2 class="text-3xl font-bold mb-8">Edit Product</h2>

  <% if (error) { %>
    <div class="mb-6 bg-red-100 text-red-700 px-4 py-3 rounded-lg">
      <%= error %>
    </div>
  <% } %>

<form
  action="/admin/products/<%= product._id %>?_method=PATCH"
  method="POST"
  enctype="multipart/form-data"
>

<!-- BASIC INFO -->
<div class="bg-white border rounded-xl p-8">
  <h3 class="font-semibold mb-6">Basic Information</h3>

  <div class="grid grid-cols-2 gap-6">
    <div>
      <label class="text-sm font-medium">
  Product Name <span class="text-red-500">*</span>
</label>
      <input name="name" value="<%= product.name %>" required
        class="w-full mt-2 border rounded-lg px-4 py-2"/>
    </div>

    <div>
      <label class="text-sm font-medium">
  Team <span class="text-red-500">*</span>
</label>
      <input name="team" value="<%= product.team %>" required
        class="w-full mt-2 border rounded-lg px-4 py-2"/>
    </div>
  </div>

  <div class="mt-6">
    <label class="text-sm font-medium">Description</label>
    <textarea name="description" rows="4"
      class="w-full mt-2 border rounded-lg px-4 py-2"><%= product.description %></textarea>
  </div>

  <div class="grid grid-cols-3 gap-6 mt-6">
    <div>
      <label class="text-sm font-medium">
  Type <span class="text-red-500">*</span>
</label>
      <select name="type" class="w-full mt-2 border rounded-lg px-4 py-2">
        <option value="Home" <%= product.type === "Home" ? "selected" : "" %>>Home</option>
        <option value="Away" <%= product.type === "Away" ? "selected" : "" %>>Away</option>
      </select>
    </div>

    <div>
     <label class="text-sm font-medium">
  Kit Type <span class="text-red-500">*</span>
</label>
      <select name="kitType" class="w-full mt-2 border rounded-lg px-4 py-2">
        <option value="Half Sleeve" <%= product.kitType === "Half Sleeve" ? "selected" : "" %>>Half Sleeve</option>
        <option value="Full Sleeve" <%= product.kitType === "Full Sleeve" ? "selected" : "" %>>Full Sleeve</option>
      </select>
    </div>

    <div>
      <label class="text-sm font-medium">Status</label>
      <select name="status" class="w-full mt-2 border rounded-lg px-4 py-2">
        <option value="Inactive" <%= product.status === "Inactive" ? "selected" : "" %>>Inactive</option>
        <option value="Active" <%= product.status === "Active" ? "selected" : "" %>>Active</option>
      </select>
    </div>
  </div>
</div>

<!-- INVENTORY LINK -->
<div class="bg-white border rounded-xl p-8">
  <h3 class="font-semibold mb-4">Inventory</h3>
  <p class="text-sm text-gray-500 mb-4">
    Size, price and stock are managed separately.
  </p>

  <a
    href="/admin/products/<%= product._id %>/inventory"
    class="inline-block bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-semibold"
  >
    Manage Inventory
  </a>
</div>

<!-- IMAGES -->
<div class="bg-white border rounded-xl p-8">
  <h3 class="font-semibold mb-6">
  Product Images <span class="text-red-500">*</span>
</h3>

  <div class="grid grid-cols-3 gap-6">
  <% for (let i = 0; i < 3; i++) { %>
    <label class="image-slot cursor-pointer">
      <input
        type="file"
        accept="image/*"
        hidden
        onchange="selectImage(event, <%= i %>)"
      />

      <% if (product.images[i]) { %>
        <img src="<%= product.images[i] %>" />
      <% } else { %>
        <div class="placeholder absolute inset-0 flex flex-col items-center justify-center">
          <span class="plus">+</span><br />Add Image
        </div>
      <% } %>
    </label>
  <% } %>
</div>


    <input type="file" name="images" id="finalImages" hidden multiple>

    
</div>

<div class="flex justify-end gap-4">
  <a href="/admin/products" class="px-8 py-2 border rounded-lg bg-white font-semibold">
    Cancel
  </a>
  <button class="px-8 py-2 bg-[#b36890] text-white rounded-lg font-semibold">
    Save Changes
  </button>
</div>

</form>
</section>
</main>

</body>
</html>
